<div class="container">
  <div class="row myBackground">
    <div class="col-md-6 offset-md-2">

    <h1>Make a gift. Save a life today.</h1>

    <p>Operation Paws for Homes depends on your generous donations to provide the medical, transportation, fostering, and adoption services needed to place 1,200 homeless dogs in forever homes each year.</p>

    <%= form_for @donation, :html=> { :multipart => true, :class => "form-horizontal" } do |f| %>
      <%= render 'shared/error_messages', object: f.object %>
        <div class="form-group">
          <%= f.label :amount %>
          <%= f.text_field :amount, class: 'input-large form-control' %>
        </div>
        <div class="form-group">
          <button type="button" class="btn btn-primary btn-lg" data-toggle="button">$25</button>
          <button type="button" class="btn btn-primary btn-lg" data-toggle="button">$75</button>
          <button type="button" class="btn btn-primary btn-lg" data-toggle="button">$100</button>
          <button type="button" class="btn btn-primary btn-lg" data-toggle="button">$200</button>
          <button type="button" class="btn btn-primary btn-lg" data-toggle="button">$500</button>
          <button type="button" class="btn btn-primary btn-lg" data-toggle="button">$1,000</button>
        </div>
        <div class="form-check">
          <input type="checkbox" class="form-check-input" id="exampleCheck1">
          <label class="form-check-label" for="exampleCheck1">Donate in Memory or Honor of Someone</label>
        </div>
        <h5>Contact Information</h5>
        <div class="form-group">
          <%= f.label :name, 'Name' %>
          <%= f.text_field :name, class: 'input-large form-control' %>
        </div>
        <div class="form-group">
          <%= f.label :email %>
          <%= f.email_field :email, class: 'input-large form-control' %>
        </div>
        <div class="form-group">
          <%= f.label :comment %>
          <%= f.text_area :comment, class: 'input-xlarge form-control', rows: '5' %>
        </div>
        <%= hidden_field_tag(:stripeToken) %>
        <button id="donateButton" class="btn btn-primary btn-lg">Donate</button>
    <% end %>
    </div>
  </div>
</div>




<script src="https://checkout.stripe.com/checkout.js"></script>

<script>


  var handler = StripeCheckout.configure({
    key: '<%= Rails.configuration.stripe[:publishable_key] %>',
    locale: 'auto',
    name: 'Operation Paws for Homes',
    description: 'One-time donation',
    panelLabel: 'Donate {{amount}}',
    zipCode: true,
    image: '/apple-touch-icon.png',

    token: function(token) {
      $('input#stripeToken').val(token.id);
      $('form').submit();
    }
  });

  $('#donateButton').on('click', function(e) {
    e.preventDefault();

    $('#error_explanation').html('');

    var email = $('input#donation_email').val();

    var amount = $('input#donation_amount').val();
    amount = amount.replace(/\$/g, '').replace(/\,/g, '')

    amount = parseFloat(amount);

    if (isNaN(amount)) {
      $('#error_explanation').html('<p>Please enter a valid amount in USD ($).</p>');
    }
    else if (amount < 5.00) {
      $('#error_explanation').html('<p>Donation amount must be at least $5.</p>');
    }
    else {
      amount = amount * 100; // Needs to be an integer!
      handler.open({
        amount: Math.round(amount),
        email: email
      })
    }
  });

  // Close Checkout on page navigation
  $(window).on('popstate', function() {
    handler.close();
  });
</script>
